<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html" />
        <link href="eve-murmur2/css/apipagecssr2.css" rel="stylesheet" type="text/css" />
        <title>EVE Murmur API Registration</title>
        <script src="eve-murmur2/js/jquery-1.5.min.js" type="text/javascript" charset="utf-8"></script>
        <script type="text/javascript" charset="utf-8">
            $.fn.preload = function() {
                this.each(function(){
                    $('<img />')[0].src = this;
                });
            }
            $(['http://www.redskymorning.com/eve-murmur2/images/ajax-loader.gif']).preload();
            $(document).ready(function() {
                $('#inputForm').submit(function(e) {
                    e.preventDefault();
                    $(':input').removeClass('invalidinput validinput');
                    $('#validError').hide();
                    $('#validError').empty();
                    var uid = $.trim($('#userIdInput').val());
                    $('#userIdInput').val(uid);
                    var key = $.trim($('#apiInput').val());
                    $('#apiInput').val(key);
                    var validUserID = validField('#userIdInput', /^\d{5,}$/);
                    var validApiKey = validField('#apiInput', /^[A-Za-z0-9]{64}$/);
                    var validPassword1 = validField('#password1', /^\w{5,}$/);
                    var validForm = true;
                    if(!validUserID) {
                        $('#userIdInput').addClass('invalidinput');
                        $('#validError').append('<h4>Invalid UserID<br />Must be at least 5 numerical digits.</h4>');
                        $('#userIdInput').removeAttr('disabled');
                        $('#validError').slideDown('slow');
                        validForm = false;
                    }
                    if(!validApiKey) {
                        $('#apiInput').addClass('invalidinput');
                        $('#validError').append('<h4>Invalid API Key<br />Must be exactly 64 characters. Letters and numbers only.</h4>');
                        $('#apiInput').removeAttr('disabled');
                        $('#validError').slideDown('slow');
                        validForm = false;
                    }
                    if(!validPassword1 && $('#charDiv').is(':visible')) {
                        $('#password1').addClass('invalidinput');
                        $('#password2').addClass('invalidinput');
                        $('#validError').append('<h4>Invalid password<br />Must be at least 5 characters. Letters, numbers and underscore only.</h4>');
                        $('#validError').slideDown('slow');
                        validForm = false;
                    }
                    if($('#password1').val() != $('#password2').val() && $('#charDiv').is(':visible')) {
                        $('#password2').addClass('invalidinput');
                        $('#validError').append('<h4>Passwords don\'t match.</h4>');
                        $('#validError').slideDown('slow');
                        validForm = false;
                    }
                    if (validForm) {
                        $('#loadingProgress').slideDown(100);
                        $.post($(this).attr("action"), $(this).serialize(), function(data) {
                            $('#loadingProgress').slideUp('slow');
                            $('#userIdInput').attr('disabled', 'disabled');
                            $('#apiInput').attr('disabled', 'disabled');
                            if(data.hasOwnProperty('type')){
                                if(data.type == 'success') {
                                    $('#validError').append('<h4>' + data.message);
                                    $('#validError').slideDown('slow');
                                } else {
                                    $('#validError').append('<h4>' + data.message);
                                    $('#validError').slideDown('slow');
                                }
                            }
                            $('#charDiv').slideDown('slow');
                            $('#charSel').empty();
                            $(data).each(function(i) {
                                $('#charSel').
                                    append($('<option></option>').
                                    attr('value',$(this)[0].charid).
                                    text($(this)[0].name));
                            });
                        }, "json");
                    }
                });
            });

            function validField(field, regex) {
                $(field).removeClass('invalidinput validinput');
                var match = $(field).val().match(regex);
                if(match == null){
                    $(field).addClass('invalidinput');
                    return false;
                } else {
                    $(field).addClass('validinput');
                    return true;
                }
            }

            function trimmer() {
                $('body :text').each(function() {
                    $(this).val() = $(this).val().trim();
                });
            }
        </script>
    </head>
    <body>
        <form name="input" id="inputForm" action="http://www.redskymorning.com/eve-murmur2/register/submit">
            <div id="apicontent">
                <h1>Mumble Registration</h1>
                <p>1. <a href="http://mumble.sourceforge.net" target="_blank">Download Mumble</a></p>
                <p>2. <a href="http://www.eveonline.com/api/" target="_blank">Get your limited API Key</a></p>
                <p>User ID:</p>
                <input type="text" class="userinput" name="userid" id="userIdInput">
                <p>Limited API:</p>
                <input type="text" class="userinput" name="apikey" id="apiInput">
                <div id="charDiv" style="display: none;">
                    <p>Character: </p>
                    <select class="userselect" name="charid" id="charSel">
                    </select>
                    <p>Password:</p>
                    <input type="password" class="userinput" name="password" id="password1">
                    <p>Confim Password:</p>
                    <input type="password" class="userinput" name="password2" id="password2">
                </div>
                <div id="validError" style="display: none;">
                </div>
                <div id="loadingProgress" style="display: none;">
                    <img src="http://www.redskymorning.com/eve-murmur2/images/ajax-loader.gif" alt="loading..." style="display: block; margin-left: auto; margin-right: auto;" />
                </div>
                <button name="save" type="submit" class="positive" id="submitButton"><!--<img src="http://www.redskymorning.com/eve-murmur2/images/apply2.png" alt=""/>-->Submit</button>
            </div>
        </form>
    </body>
</html>